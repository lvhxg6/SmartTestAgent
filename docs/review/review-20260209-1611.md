# Review Report

## 1) 摘要
本次基于**更新后的** `requirements.md`（241 行）重新对照 `docs/ancient-hatching-mitten.md`（961 行）进行一致性审查。主流程仍然完整，但新增的细化验收条目有多处尚未在设计文档落地，集中在配置模型、源码索引细则、Ant Design 选择器细则、Codex 审核输出结构与监控 UI 字段映射。

## 2) 问题清单

### 高
1. Requirement 1 新增配置字段未落地：`ignoreHTTPSErrors`、`antd_quirks`、`ui_framework` 及其行为约束缺失。  
   - 要求证据：`.kiro/specs/prd-ui-testing-agent/requirements.md:30`、`.kiro/specs/prd-ui-testing-agent/requirements.md:31`、`.kiro/specs/prd-ui-testing-agent/requirements.md:32`、`.kiro/specs/prd-ui-testing-agent/requirements.md:33`、`.kiro/specs/prd-ui-testing-agent/requirements.md:34`  
   - 设计现状：`target_profile` 示例与字段说明未包含上述字段或执行语义（`docs/ancient-hatching-mitten.md:72`、`docs/ancient-hatching-mitten.md:105`）。

2. Requirement 4 细化规则未落地：两字中文按钮正则、三字及以上精确匹配、AntD Select/Modal 专项策略、`scrollIntoViewIfNeeded()` 规则缺失。  
   - 要求证据：`.kiro/specs/prd-ui-testing-agent/requirements.md:72`、`.kiro/specs/prd-ui-testing-agent/requirements.md:73`、`.kiro/specs/prd-ui-testing-agent/requirements.md:74`、`.kiro/specs/prd-ui-testing-agent/requirements.md:75`、`.kiro/specs/prd-ui-testing-agent/requirements.md:79`  
   - 设计现状：仅有通用选择器优先级和禁止项，缺少上述专项规则（`docs/ancient-hatching-mitten.md:116`）。

3. Requirement 16 的实时监控数据模型未落地：`current_state`、`completed_steps`、`remaining_steps`、`step_screenshot_preview` 与 WebSocket 事件映射未定义。  
   - 要求证据：`.kiro/specs/prd-ui-testing-agent/requirements.md:224`、`.kiro/specs/prd-ui-testing-agent/requirements.md:225`、`.kiro/specs/prd-ui-testing-agent/requirements.md:226`、`.kiro/specs/prd-ui-testing-agent/requirements.md:227`、`.kiro/specs/prd-ui-testing-agent/requirements.md:228`、`.kiro/specs/prd-ui-testing-agent/requirements.md:229`  
   - 设计现状：仅有“WebSocket 推送”和“执行监控页”概述，未下沉到字段/事件映射层（`docs/ancient-hatching-mitten.md:344`、`docs/ancient-hatching-mitten.md:690`）。

### 中
4. Requirement 2 的 Vue/React 大文件提取细则未落地：React `.tsx/.jsx` 抽取口径、框架检测规则未明确。  
   - 要求证据：`.kiro/specs/prd-ui-testing-agent/requirements.md:46`、`.kiro/specs/prd-ui-testing-agent/requirements.md:47`、`.kiro/specs/prd-ui-testing-agent/requirements.md:48`、`.kiro/specs/prd-ui-testing-agent/requirements.md:49`  
   - 设计现状：仅写“单文件 >500 行裁剪模板+关键脚本”，未区分 Vue 与 React 抽取策略，也未定义 vue-router/react-router 检测（`docs/ancient-hatching-mitten.md:157`）。

5. Requirement 5 的 `p0_coverage_check` 输出契约未落地到审核结构。  
   - 要求证据：`.kiro/specs/prd-ui-testing-agent/requirements.md:88`、`.kiro/specs/prd-ui-testing-agent/requirements.md:90`、`.kiro/specs/prd-ui-testing-agent/requirements.md:91`  
   - 设计现状：流程里提到“覆盖率是否足够”，但 `codex-review` 的 schema 说明未包含 `p0_coverage_check.status` 与 `missing_p0_ids`（`docs/ancient-hatching-mitten.md:206`、`docs/ancient-hatching-mitten.md:886`）。

## 3) 修改建议
1. 在 `target_profile` 与字段表中补齐 `browser.ignoreHTTPSErrors`、`antd_quirks`、`ui_framework`，并写明运行时映射到 Playwright context 和选择器生成逻辑。  
2. 在“选择器策略”新增 AntD 专项规则子节，逐条对应 requirement 4 的 AC-3~AC-6、AC-10。  
3. 在“源码辅助生成机制”新增“双框架提取策略”子节，分别定义 Vue 与 React 的 >500 行裁剪内容与框架识别规则。  
4. 扩展 `codex-review-results` schema，新增 `p0_coverage_check: { status, missing_p0_ids }`，并在 Step 1 审核输出说明中引用。  
5. 增补“监控页面数据契约”小节：定义 `current_state/completed_steps/remaining_steps/step_screenshot_preview` 字段，以及 `state_transition/step_completed/step_screenshot` 事件到字段映射。

## 5) 风险/待确认点
- 本轮审查已覆盖 17 条 Requirement 的新增重点，但仍属于文档对文档审查，不包含代码实现验证。
- 若你希望本轮“完全无遗漏”再确认，建议下一步按上述 5 项补齐后再做一次复审闭环。
